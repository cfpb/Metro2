# Metro2 Tool Front-End

## Overview

The Metro 2 front end provides a user interface for interacting with the results of the evaluators run on a set of Metro 2 data (internally termed an `event`). The tool consists of several pages, including:

- Landing page: a home page listing all the `events` that are assigned to the user
- Event page: an overview page for a specific event, showing a table of all the evaluators that detected inconsistencies in that event's Metro 2 data set. There are also two types of child pages for each event:

  - Evaluator page: a page for the results of a specific evaluator that had hits on the event. The evaluator page combines information specific to the event (date range, number of times the evaluator hit on the event's data, number of individual accounts affected) and metadata about the evaluator itself (description, pseudo code representation, etc.)

    It also displays a table containing the individual Metro 2 account records that were flagged by the evaluator. Users can toggle between a sample view of the table, which shows 20 representative account records, and a full results view, which allows filtering of all the flagged account records by multiple fields (account status, amount past due, etc.) The evaluator table displays a subset of Metro 2 fields -- the fields used by the evaluator, related fields, and the filterable fields.

    Users can download all results, the representative sample, or filtered results for the evaluator, depending on the current view. Evaluator page state is stored in the URL, so the tool also provides copy url functionality to let users return to a specific view of the results.

  - Account page: a page for a specific account from an event's Metro 2 data. The account page displays a table containing all the records for that account over the course of the event's time frame and indicates which evaluators hit for each record.

- User guide: a set of pages containing information on how to use the tool's user interface

## Features

### Main frameworks

- [Vite](https://vitejs.dev) with [React](https://reactjs.org), [TypeScript](https://www.typescriptlang.org) and [absolute imports](https://github.com/aleclarson/vite-tsconfig-paths).
- [Tanstack-router](https://tanstack.com/router/latest), [react-query](https://tanstack.com/query/latest), and the [AG Grid table library](https://www.ag-grid.com/) community edition
- Uses [ESLint](https://eslint.org), [stylelint](https://stylelint.io) and [Prettier](https://prettier.io)
- Unit and integration tests with [Vitest](https://vitest.dev/) and [Testing Library](https://testing-library.com/).
- e2e and component tests with [Cypress](https://www.cypress.io).

## Running locally

### Requirements

- Node.js (v18+)
- yarn (berry)
- npm

To run successfully, the front end needs access to the API provided by the Django app. There are a couple of ways to accomplish this:

1. The simplest option is to run the full app with docker-compose as described in the main README (`docker compose build` and `docker compose up`).

2. You can also run the app locally by following the directions to run the Django app in the Django directory's README and then running `yarn install` and `yarn dev` in the `front-end` directory.

In either case, navigate to [http://localhost:3000](http://localhost:3000) to view the front end of the app.

## Main Scripts

In `front-end` you can run:

`yarn dev`: Runs the app in development mode at [http://localhost:3000](http://localhost:3000), using a vite server proxy to redirect API requests. The page will reload if you edit `src` files.

`yarn validate`: Runs linting and tests against the app in dev mode.

`yarn build`: Builds files for production to the `dist` directory.

`yarn preview`: Previews the files generated by the build script at [http://localhost:4173](http://localhost:4173). The server is only proxied in dev mode, though, so previewing the built app will result in an error view for all pages except the user guide.

## Available Scripts

- `yarn dev` - start a development server with hot reload.
- `yarn build` - build for production. The generated files will be on the `dist` folder.
- `yarn preview` - locally preview the production build.
- `yarn test` - run unit tests related to changed files based on git.
- `yarn test:ci` - run all unit tests in CI mode.
- `yarn test:component` - opens headed component tests with the Cypress Test Runner UI.
- `yarn test:component:headless` - run all component tests headlessly.
- `yarn test:e2e` - opens headed e2e tests with the Cypress Test Runner UI.
- `yarn test:e2e:headless` - run all e2e tests headlessly.
- `yarn test:cypress` - opens headed Cypress tests with Cypress Test Runner UI.
- `yarn test:cypress:headless` - run Cypress component and e2e tests headlessly.
- `yarn format` - format all files with Prettier.
- `yarn run-eslint` - runs JavaScript linting.
- `yarn run-stylelint` - runs CSS linting.
- `yarn run-tsc` - runs Typescript linting.
- `yarn lint` - runs TypeScript, ESLint and Stylelint.
- `yarn validate` - runs `lint`, `test:ci` and `test:cypress:headless`.
